---
title: Setup Node with pnpm
description: Set up Node.js and pnpm with automatic caching
---

The `setup-node-with-pnpm` action provides a convenient way to set up Node.js and pnpm in your GitHub Actions workflows with automatic dependency caching.

## Overview

This composite action combines:
- pnpm setup using `pnpm/action-setup@v4`
- Node.js setup using `actions/setup-node@v6` with pnpm cache enabled
- Automatic dependency installation

## Inputs

| Input | Description | Required | Default |
|-------|-------------|----------|---------|
| `OPTIONAL_INSTALL_COMMAND` | Optional install command string (e.g., `--frozen-lockfile`, `--no-frozen-lockfile`) | No | - |

## Requirements

- A `.nvmrc` file in your repository root specifying the Node.js version
- The action will read the Node.js version from this file automatically

## Usage

### In the Same Repository

If you're using this action within the same repository where it's defined:

```yaml
name: CI

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v6

      - name: Setup Node.js and pnpm
        uses: ./.github/actions/setup-node-with-pnpm

      - name: Build
        run: pnpm build
```

### From External Repository

To use this action in an external repository:

```yaml
name: CI

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v6

      - name: Setup Node.js and pnpm
        uses: chia1104/chiastack.dev/.github/actions/setup-node-with-pnpm@main

      - name: Build
        run: pnpm build
```

Replace `chia1104/chiastack.dev` with your repository owner and name, and `@main` with the branch or tag you want to use.

### With Optional Install Command

You can pass additional flags to the `pnpm install` command:

```yaml
- name: Setup Node.js and pnpm
  uses: chia1104/chiastack.dev/.github/actions/setup-node-with-pnpm@main
  with:
    OPTIONAL_INSTALL_COMMAND: --frozen-lockfile
```

Common options:
- `--frozen-lockfile` - Install dependencies without updating the lockfile
- `--no-frozen-lockfile` - Allow lockfile updates during installation
- `--prefer-offline` - Use offline mode when possible

### Using a Specific Version

For better stability, pin to a specific commit SHA or tag:

```yaml
- name: Setup Node.js and pnpm
  uses: chia1104/chiastack.dev/.github/actions/setup-node-with-pnpm@v1.0.0
```

## Complete Example Workflow

Here's a complete CI workflow example:

```yaml
name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v6

      - name: Setup Node.js and pnpm
        uses: chia1104/chiastack.dev/.github/actions/setup-node-with-pnpm@main
        with:
          OPTIONAL_INSTALL_COMMAND: --frozen-lockfile

      - name: Run linter
        run: pnpm lint

      - name: Run tests
        run: pnpm test

      - name: Build
        run: pnpm build
```

## What This Action Does

1. **Sets up pnpm**: Installs pnpm using `pnpm/action-setup@v4` without running install automatically
2. **Sets up Node.js**: Configures Node.js using `actions/setup-node@v6`:
   - Reads version from `.nvmrc` file
   - Enables pnpm cache for faster subsequent runs
3. **Installs dependencies**: Runs `pnpm install` (with optional flags if provided)

## Caching

The action automatically enables pnpm cache through `actions/setup-node@v6`. This means:
- Dependencies are cached between workflow runs
- Faster subsequent builds
- Reduced network usage

The cache key is automatically generated based on your `pnpm-lock.yaml` file.

## Creating `.nvmrc` File

Create a `.nvmrc` file in your repository root with the Node.js version:

```bash
# .nvmrc
24
```

## Notes

- The action uses `run_install: false` for pnpm setup, then manually runs `pnpm install` to allow custom flags
- Node.js version is read from `.nvmrc` file automatically
- pnpm cache is enabled by default for faster builds
- The action is idempotent - safe to run multiple times

