---
title: Clean PR Cache
description: Clean up GitHub Actions caches for a specific PR branch
---

The `clean-pr-cache` action helps you clean up GitHub Actions caches for a specific pull request branch. This is useful for managing cache storage and ensuring clean builds.

## Overview

This action uses the GitHub CLI (`gh`) with the `actions-cache` extension to list and delete cache entries associated with a specific PR branch.

## Inputs

| Input | Description | Required | Default |
|-------|-------------|----------|---------|
| `REPO` | Repository name in the format `owner/repo` (e.g., `chia1104/chiastack.dev`) | Yes | - |
| `BRANCH` | Branch reference in the format `refs/pull/123/merge` | Yes | - |
| `GH_TOKEN` | GitHub token for authentication. Use `${{ secrets.GITHUB_TOKEN }}` for default token | Yes | - |

## Usage

### In the Same Repository

If you're using this action within the same repository where it's defined:

```yaml
name: Cleanup PR Caches

on:
  pull_request:
    types: [closed]

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v6

      - name: Cleanup PR caches
        uses: ./.github/actions/clean-pr-cache
        with:
          REPO: ${{ github.repository }}
          BRANCH: "refs/pull/${{ github.event.pull_request.number }}/merge"
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### From External Repository

To use this action in an external repository, reference it using the full path:

```yaml
name: Cleanup PR Caches

on:
  pull_request:
    types: [closed]

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v6

      - name: Cleanup PR caches
        uses: chia1104/chiastack.dev/.github/actions/clean-pr-cache@main
        with:
          REPO: ${{ github.repository }}
          BRANCH: "refs/pull/${{ github.event.pull_request.number }}/merge"
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

Replace `chia1104/chiastack.dev` with your repository owner and name, and `@main` with the branch or tag you want to use.

### Using a Specific Version

For better stability, you can pin to a specific commit SHA or tag:

```yaml
- name: Cleanup PR caches
  uses: chia1104/chiastack.dev/.github/actions/clean-pr-cache@v1.0.0
  with:
    REPO: ${{ github.repository }}
    BRANCH: "refs/pull/${{ github.event.pull_request.number }}/merge"
    GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

## How It Works

1. Installs the `gh` CLI extension `actions/gh-actions-cache`
2. Lists all cache keys for the specified branch (up to 100 entries)
3. Deletes each cache key found
4. Uses `set +e` to prevent workflow failure if cache deletion encounters errors

## Example Workflow

A complete example workflow that cleans up caches when a PR is closed:

```yaml
name: Cleanup PR Caches

on:
  pull_request:
    types: [closed]

permissions:
  contents: read
  actions: write

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v6

      - name: Cleanup PR caches
        uses: chia1104/chiastack.dev/.github/actions/clean-pr-cache@main
        with:
          REPO: ${{ github.repository }}
          BRANCH: "refs/pull/${{ github.event.pull_request.number }}/merge"
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

## Permissions

This action requires the following permissions:

- `actions: write` - To delete cache entries

Make sure your workflow has these permissions configured:

```yaml
permissions:
  actions: write
```

## Notes

- The action will exit successfully even if no cache keys are found
- Cache deletion errors won't fail the workflow (using `set +e`)
- The action can handle up to 100 cache entries per branch
- The `GH_TOKEN` can be the default `GITHUB_TOKEN` or a custom token with appropriate permissions

