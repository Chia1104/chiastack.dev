---
title: Setup Node with pnpm
description: 設置 Node.js 和 pnpm 並啟用自動快取
---

`setup-node-with-pnpm` action 提供了一種便捷的方式，可在您的 GitHub Actions 工作流程中設置 Node.js 和 pnpm，並啟用自動依賴項快取。

## 概述

此 composite action 結合了：
- 使用 `pnpm/action-setup@v4` 設置 pnpm
- 使用 `actions/setup-node@v6` 設置 Node.js，並啟用 pnpm 快取
- 自動安裝依賴項

## 輸入參數

| 參數 | 說明 | 必填 | 預設值 |
|------|------|------|--------|
| `OPTIONAL_INSTALL_COMMAND` | 可選的安裝命令字串（例如：`--frozen-lockfile`、`--no-frozen-lockfile`） | 否 | - |

## 需求

- 在儲存庫根目錄中需要有 `.nvmrc` 檔案來指定 Node.js 版本
- action 會自動從此檔案讀取 Node.js 版本

## 使用方法

### 在同一個儲存庫中使用

如果您在定義此 action 的同一個儲存庫中使用：

```yaml
name: CI

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v6

      - name: Setup Node.js and pnpm
        uses: ./.github/actions/setup-node-with-pnpm

      - name: Build
        run: pnpm build
```

### 從外部儲存庫使用

要在外部儲存庫中使用此 action：

```yaml
name: CI

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v6

      - name: Setup Node.js and pnpm
        uses: chia1104/chiastack.dev/.github/actions/setup-node-with-pnpm@main

      - name: Build
        run: pnpm build
```

請將 `chia1104/chiastack.dev` 替換為您的儲存庫擁有者和名稱，並將 `@main` 替換為您要使用的分支或標籤。

### 使用可選的安裝命令

您可以將額外的標誌傳遞給 `pnpm install` 命令：

```yaml
- name: Setup Node.js and pnpm
  uses: chia1104/chiastack.dev/.github/actions/setup-node-with-pnpm@main
  with:
    OPTIONAL_INSTALL_COMMAND: --frozen-lockfile
```

常見選項：
- `--frozen-lockfile` - 安裝依賴項而不更新 lockfile
- `--no-frozen-lockfile` - 允許在安裝期間更新 lockfile
- `--prefer-offline` - 盡可能使用離線模式

### 使用特定版本

為了更好的穩定性，可以固定到特定的 commit SHA 或標籤：

```yaml
- name: Setup Node.js and pnpm
  uses: chia1104/chiastack.dev/.github/actions/setup-node-with-pnpm@v1.0.0
```

## 完整範例工作流程

這是一個完整的 CI 工作流程範例：

```yaml
name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v6

      - name: Setup Node.js and pnpm
        uses: chia1104/chiastack.dev/.github/actions/setup-node-with-pnpm@main
        with:
          OPTIONAL_INSTALL_COMMAND: --frozen-lockfile

      - name: Run linter
        run: pnpm lint

      - name: Run tests
        run: pnpm test

      - name: Build
        run: pnpm build
```

## 此 Action 的功能

1. **設置 pnpm**：使用 `pnpm/action-setup@v4` 安裝 pnpm，但不自動執行安裝
2. **設置 Node.js**：使用 `actions/setup-node@v6` 配置 Node.js：
   - 從 `.nvmrc` 檔案讀取版本
   - 啟用 pnpm 快取以加快後續執行速度
3. **安裝依賴項**：執行 `pnpm install`（如果提供了可選標誌，則使用這些標誌）

## 快取

action 會透過 `actions/setup-node@v6` 自動啟用 pnpm 快取。這意味著：
- 依賴項在工作流程執行之間會被快取
- 更快的後續建置
- 減少網路使用量

快取鍵會根據您的 `pnpm-lock.yaml` 檔案自動生成。

## 建立 `.nvmrc` 檔案

在儲存庫根目錄中建立一個 `.nvmrc` 檔案，指定 Node.js 版本：

```bash
# .nvmrc
24
```

## 注意事項

- action 對 pnpm 設置使用 `run_install: false`，然後手動執行 `pnpm install` 以允許自訂標誌
- Node.js 版本會自動從 `.nvmrc` 檔案讀取
- 預設啟用 pnpm 快取以加快建置速度
- action 是冪等的 - 可以安全地多次執行

