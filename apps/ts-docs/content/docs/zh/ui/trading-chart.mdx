---
title: Trading Chart
description: 交易圖表元件，基於 lightweight-charts 構建
---

交易圖表相關元件，基於 `lightweight-charts` 構建，提供完整的交易圖表功能。

![TradingView](/tradingview-light.png)

## 安裝

<Tabs items={['npm', 'pnpm', 'yarn', 'bun']}>
  <Tab value="npm">
    ```bash
    npm install @chiastack/ui lightweight-charts technicalindicators
    ```
  </Tab>
  <Tab value="pnpm">
    ```bash
    pnpm add @chiastack/ui lightweight-charts technicalindicators
    ```
  </Tab>
  <Tab value="yarn">
    ```bash
    yarn add @chiastack/ui lightweight-charts technicalindicators
    ```
  </Tab>
  <Tab value="bun">
    ```bash
    bun add @chiastack/ui lightweight-charts technicalindicators
    ```
  </Tab>
</Tabs>

## 元件

### Chart

圖表容器元件，用於創建和初始化圖表實例。

```tsx
import { Chart } from '@chiastack/ui/trading-chart/chart';
import { CandlestickSeries } from 'lightweight-charts';

function TradingChart() {
  const data = [
    { time: '2024-01-01', open: 100, high: 110, low: 95, close: 105 },
    { time: '2024-01-02', open: 105, high: 115, low: 100, close: 110 },
  ];

  return (
    <Chart
      layout={{ background: { color: '#ffffff' } }}
      onInit={(chart) => {
        console.log('Chart initialized:', chart);
      }}
    >
      {/* Series components go here */}
    </Chart>
  );
}
```

**Props:**
- `children`: React.ReactNode - 子元件（通常是 Series 元件）
- `layout?: DeepPartial<ChartOptions["layout"]>` - 圖表佈局選項
- `initOptions?: DeepPartial<ChartOptions>` - 圖表初始化選項
- `onInit?: (chart: IChartApi) => void` - 圖表初始化回調

### Series

數據系列元件，用於在圖表上添加各種類型的數據系列。

```tsx
import { Series } from '@chiastack/ui/trading-chart/series';
import { CandlestickSeries, LineSeries } from 'lightweight-charts';

function ChartWithSeries() {
  const candlestickData = [
    { time: '2024-01-01', open: 100, high: 110, low: 95, close: 105 },
    { time: '2024-01-02', open: 105, high: 115, low: 100, close: 110 },
  ];

  const lineData = [
    { time: '2024-01-01', value: 105 },
    { time: '2024-01-02', value: 110 },
  ];

  return (
    <Chart>
      <Series
        series={CandlestickSeries}
        data={candlestickData}
        options={{ upColor: '#26a69a', downColor: '#ef5350' }}
      />
      <Series
        series={LineSeries}
        data={lineData}
        options={{ color: '#2962FF', lineWidth: 2 }}
      />
    </Chart>
  );
}
```

**Props:**
- `data`: `SeriesDataItemTypeMap[TTime][T][]` - 數據陣列
- `series`: `SeriesDefinition<T>` - 系列類型定義
- `options?: SeriesPartialOptionsMap[T]` - 系列選項
- `onInit?: (series: ISeriesApi<T>, chart: IChartApi | null) => void` - 系列初始化回調
- `children?: React.ReactNode` - 子元件

### MacdSeries

MACD（Moving Average Convergence Divergence）技術指標系列元件。

```tsx
import { MacdSeries } from '@chiastack/ui/trading-chart/macd-series';

function ChartWithMacd() {
  const data = [
    { time: '2024-01-01', close: 100 },
    { time: '2024-01-02', close: 105 },
    { time: '2024-01-03', close: 110 },
  ];

  return (
    <Chart>
      <MacdSeries
        data={data}
        fastPeriod={12}
        slowPeriod={26}
        signalPeriod={9}
        paneIndex={1}
        macdLineOptions={{ color: '#2962FF', lineWidth: 2 }}
        signalLineOptions={{ color: '#FF6D00', lineWidth: 2 }}
        histogramOptions={{
          upColor: '#26a69a',
          downColor: '#ef5350',
        }}
      />
    </Chart>
  );
}
```

**Props:**
- `data`: `MacdData<TTime>[]` - 包含時間和收盤價的數據陣列
- `fastPeriod?: number` - 快速週期（預設：12）
- `slowPeriod?: number` - 慢速週期（預設：26）
- `signalPeriod?: number` - 信號週期（預設：9）
- `paneIndex?: number` - 窗格索引（預設：1）
- `macdLineOptions?: { color?: string; lineWidth?: number }` - MACD 線樣式選項
- `signalLineOptions?: { color?: string; lineWidth?: number }` - 信號線樣式選項
- `histogramOptions?: { upColor?: string; downColor?: string }` - 直方圖樣式選項

### RsiSeries

RSI（Relative Strength Index）技術指標系列元件。

```tsx
import { RsiSeries } from '@chiastack/ui/trading-chart/rsi-series';

function ChartWithRsi() {
  const data = [
    { time: '2024-01-01', close: 100 },
    { time: '2024-01-02', close: 105 },
    { time: '2024-01-03', close: 110 },
  ];

  return (
    <Chart>
      <RsiSeries
        data={data}
        period={14}
        paneIndex={2}
        overboughtLevel={70}
        oversoldLevel={30}
        rsiLineOptions={{ color: '#9C27B0', lineWidth: 2 }}
        overboughtOptions={{ color: '#FF5722', lineWidth: 1 }}
        oversoldOptions={{ color: '#4CAF50', lineWidth: 1 }}
        showLevels={true}
      />
    </Chart>
  );
}
```

**Props:**
- `data`: `RsiData<TTime>[]` - 包含時間和收盤價的數據陣列
- `period?: number` - RSI 計算週期（預設：14）
- `paneIndex?: number` - 窗格索引（預設：2）
- `overboughtLevel?: number` - 超買水平（預設：70）
- `oversoldLevel?: number` - 超賣水平（預設：30）
- `rsiLineOptions?: { color?: string; lineWidth?: number }` - RSI 線樣式選項
- `overboughtOptions?: { color?: string; lineWidth?: number }` - 超買線樣式選項
- `oversoldOptions?: { color?: string; lineWidth?: number }` - 超賣線樣式選項
- `showLevels?: boolean` - 是否顯示超買/超賣水平線（預設：true）

### SubscribeVisibleLogicalRange

訂閱圖表可見邏輯範圍變化的元件，用於實現數據懶加載等功能。

```tsx
import { SubscribeVisibleLogicalRange } from '@chiastack/ui/trading-chart/subscrib-visible-logical-range';

function ChartWithRangeSubscription() {
  const handleRangeChange = React.useCallback((from: number) => {
    console.log('Visible range from:', from);
    // 載入更多數據
  }, []);

  return (
    <Chart>
      <SubscribeVisibleLogicalRange
        method={handleRangeChange}
        enabled={true}
      />
    </Chart>
  );
}
```

**Props:**
- `method: (range: number) => void | Promise<void>` - 範圍變化回調函數
- `enabled?: boolean` - 是否啟用訂閱（預設：true）

## Context Hooks

### useChartContext

獲取圖表上下文，用於在子元件中訪問圖表 API。

```tsx
import { useChartContext } from '@chiastack/ui/trading-chart/chart.context';

function CustomComponent() {
  const chart = useChartContext('CustomComponent');
  const api = chart.api();
  
  // 使用圖表 API
  api.timeScale().fitContent();
}
```

### useSeriesContext

獲取系列上下文，用於在子元件中訪問系列 API。

```tsx
import { useSeriesContext } from '@chiastack/ui/trading-chart/series.context';

function CustomSeriesComponent() {
  const series = useSeriesContext('CustomSeriesComponent');
  const api = series.api();
  
  // 使用系列 API
  api.setMarkers([{ time: '2024-01-01', position: 'belowBar' }]);
}
```

## 完整範例

```tsx
import { Chart } from '@chiastack/ui/trading-chart/chart';
import { Series } from '@chiastack/ui/trading-chart/series';
import { MacdSeries } from '@chiastack/ui/trading-chart/macd-series';
import { RsiSeries } from '@chiastack/ui/trading-chart/rsi-series';
import { CandlestickSeries } from 'lightweight-charts';

function TradingView() {
  const candlestickData = [
    { time: '2024-01-01', open: 100, high: 110, low: 95, close: 105 },
    { time: '2024-01-02', open: 105, high: 115, low: 100, close: 110 },
  ];

  const macdData = [
    { time: '2024-01-01', close: 100 },
    { time: '2024-01-02', close: 105 },
  ];

  return (
    <Chart
      layout={{ background: { color: '#ffffff' } }}
      onInit={(chart) => console.log('Chart ready')}
    >
      <Series
        series={CandlestickSeries}
        data={candlestickData}
        options={{ upColor: '#26a69a', downColor: '#ef5350' }}
      />
      <MacdSeries data={macdData} />
      <RsiSeries data={macdData} />
    </Chart>
  );
}
```

